<div class="performance-container">
  <!-- Header -->
  <div class="header-section">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2 class="section-title">Performans İzleme Paneli</h2>
        <p class="section-subtitle">Sistem performans metrikleri ve endpoint istatistikleri</p>
      </div>
      <button class="btn btn-outline-secondary" (click)="clearMetrics()">
        <i class="bi bi-arrow-clockwise me-1"></i> Metrikleri Sıfırla
      </button>
    </div>
  </div>

  <!-- Metrics Cards -->
  <div class="metrics-grid">
    <!-- Response Time Card -->
    <div class="metric-card">
      <div class="metric-card-content">
        <div>
          <h3 class="metric-title">Ortalama Yanıt Süresi</h3>
          <div class="metric-value text-primary">{{averageResponseTime.toFixed(2)}} ms</div>
          <div class="metric-subtitle">Son 5 dakikadaki ortalama</div>
        </div>
        <div class="metric-icon bg-primary-light">
          <i class="bi bi-clock"></i>
        </div>
      </div>
    </div>

    <!-- High Latency Card -->
    <div class="metric-card">
      <div class="metric-card-content">
        <div>
          <h3 class="metric-title">Yüksek Gecikme Sayısı</h3>
          <div class="metric-value" [ngClass]="{'text-danger': highLatencyCount > 10, 'text-dark': highLatencyCount <= 10}">
            {{highLatencyCount}}
          </div>
          <div class="metric-subtitle">Kritik eşik üstü istekler</div>
        </div>
        <div class="metric-icon bg-danger-light">
          <i class="bi bi-exclamation-triangle"></i>
        </div>
      </div>
    </div>

    <!-- Endpoints Card -->
    <div class="metric-card">
      <div class="metric-card-content">
        <div>
          <h3 class="metric-title">İzlenen Endpoint Sayısı</h3>
          <div class="metric-value text-success">{{endpointCount}}</div>
          <div class="metric-subtitle">Aktif izlenen endpoint'ler</div>
        </div>
        <div class="metric-icon bg-success-light">
          <i class="bi bi-graph-up"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Alerts Section -->
  <div class="alerts-card" *ngIf="recentAlerts.length > 0">
    <h3 class="alerts-title">
      <i class="bi bi-exclamation-triangle-fill me-2"></i> Son Uyarılar
    </h3>
    <div class="alerts-container">
      <div *ngFor="let alert of recentAlerts" 
           [ngClass]="['alert', getAlertClass(alert.type)]">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <strong>{{alert.type === 'critical' ? 'Kritik' : 'Uyarı'}}:</strong> 
            {{alert.endpoint}}
          </div>
          <div class="ms-3 text-nowrap small">
            {{alert.timestamp | date:'medium'}}
          </div>
        </div>
        <div>Yanıt süresi: <strong>{{alert.duration}} ms</strong></div>
      </div>
    </div>
  </div>

  <!-- Chart Section -->
  <div class="chart-card">
    <div class="chart-header">
      <div>
        <h3 class="chart-title">Yanıt Süreleri Grafiği</h3>
        <div class="chart-subtitle">Son 20 ölçümün gerçek zamanlı grafiği</div>
      </div>
      <!-- Time Range Selector -->
      <div class="time-range-selector">
        <div class="btn-group" role="group">
          <button class="btn btn-sm" [ngClass]="selectedTimeRange === '5min' ? 'btn-primary' : 'btn-outline-primary'" (click)="changeTimeRange('5min')">Son 5dk</button>
          <button class="btn btn-sm" [ngClass]="selectedTimeRange === '15min' ? 'btn-primary' : 'btn-outline-primary'" (click)="changeTimeRange('15min')">Son 15dk</button>
          <button class="btn btn-sm" [ngClass]="selectedTimeRange === '1h' ? 'btn-primary' : 'btn-outline-primary'" (click)="changeTimeRange('1h')">Son 1sa</button>
        </div>
      </div>
    </div>
    <div class="chart-container">
      <canvas id="performanceChart"></canvas>
    </div>
  </div>

  <!-- Endpoints Table Section -->
  <div class="table-card">
    <div class="table-header">
      <div>
        <h3 class="table-title">Endpoint Performans Detayları</h3>
        <div class="table-subtitle">Tüm endpoint'lerin performans metrikleri</div>
      </div>
      <!-- Search Box -->
      <div class="search-container">
        <i class="bi bi-search search-icon"></i>
        <input type="text" 
               class="search-input"
               placeholder="Endpoint ara..."
               (input)="onSearch($event)">
      </div>
    </div>

    <div class="table-responsive">
      <table class="performance-table">
        <thead>
          <tr>
            <th>Endpoint</th>
            <th>Ort. Yanıt Süresi</th>
            <th>Son İstek</th>
            <th>Durum</th>
            <th>Trend</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let metric of filteredMetrics">
            <td class="endpoint-cell">
              {{metric.endpoint}}
            </td>
            <td>
              {{metric.avgResponseTime.toFixed(2)}} ms
            </td>
            <td>
              {{metric.lastRequest | date:'medium'}}
            </td>
            <td>
              <span [class]="getStatusClass(metric.avgResponseTime)">
                {{getStatusText(metric.avgResponseTime)}}
              </span>
            </td>
            <td>
              <div class="trend-icon">
                <i *ngIf="metric.avgResponseTime < 100" class="bi bi-arrow-up-circle-fill text-success"></i>
                <i *ngIf="metric.avgResponseTime >= 100" class="bi bi-arrow-down-circle-fill text-danger"></i>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="filteredMetrics.length === 0" class="empty-state">
        <i class="bi bi-clipboard-data"></i>
        <h3>Veri Bulunamadı</h3>
        <p *ngIf="searchTerm && endpointMetrics.length > 0">Arama kriterlerine uygun endpoint bulunamadı. Lütfen farklı bir arama terimi deneyin.</p>
        <p *ngIf="endpointMetrics.length === 0">Henüz hiçbir endpoint verisi toplanmadı.</p>
      </div>
    </div>
  </div>
  <!-- Sitemap Monitoring -->
  <div class="card mt-4">
    <div class="card-header">
      <h5 class="card-title">
        <i class="bi bi-diagram-3 me-2"></i>
        Site Haritası İzleme
      </h5>
    </div>
    <div class="card-body">
      <app-sitemap-monitoring></app-sitemap-monitoring>
    </div>
  </div>
</div>
<app-main-header></app-main-header>
<app-navbar></app-navbar>
<div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-8">
        <!-- <button class="sidebar-toggle d-lg-none" (click)="toggleSidebar()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
            </svg>
            Menu
          </button> -->
        <div class="main-wrapper">
            <!-- <div class="sidebar-overlay" [class.active]="isSidebarOpen" (click)="toggleSidebar()"></div>
            <app-user-sidebar [class.active]="isSidebarOpen" class="user-sidebar"></app-user-sidebar> -->
            <div class="container">
                <!-- User Info Section -->
                <div class="card fade-in">
                    <div class="card-header">
                        <h3 class="card-title">User Info</h3>
                    </div>
                    <div class="card-body profile-info">
                        <div class="row" *ngIf="!isLoadingUser; else userSkeleton">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="info-label">User Name</div>
                                    <div class="info-value">{{ user?.userName }}</div>
                                </div>
                                <div class="col-md-6">
                                    <div class="info-label">Full Name</div>
                                    <div class="info-value">{{ user?.nameSurname }}</div>
                                </div>
                                <div class="col-12">
                                    <div class="info-label">E-Mail</div>
                                    <div class="info-value">{{ user?.email }}</div>
                                </div>
                            </div>
                        </div>
                        <ng-template #userSkeleton>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="skeleton-label"></div>
                                    <div class="skeleton-value"></div>
                                </div>
                                <div class="col-md-6">
                                    <div class="skeleton-label"></div>
                                    <div class="skeleton-value"></div>
                                </div>
                                <div class="col-12">
                                    <div class="skeleton-label"></div>
                                    <div class="skeleton-value"></div>
                                </div>
                            </div>
                        </ng-template>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title mb-0">Password Change</h3>
                    </div>
                    <div class="card-body">
                        <form [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()">
                            <div class="form-floating mb-3">
                                <input type="password" class="form-control" formControlName="currentPassword"
                                    id="currentPassword" placeholder="Current Password" [ngClass]="{'is-invalid': (component['currentPassword'].invalid && component['currentPassword'].dirty) || 
                                    (submitted && component['currentPassword'].invalid)}">
                                <label for="currentPassword">Current Password</label>
                                <div class="invalid-feedback" *ngIf="component['currentPassword'].invalid && 
                       (component['currentPassword'].dirty || submitted)">
                                    <span *ngIf="component['currentPassword'].errors?.['required']">Current Password
                                        Required</span>
                                </div>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="password" class="form-control" formControlName="newPassword"
                                    id="newPassword" placeholder="New Password"
                                    [ngClass]="{'is-invalid': (component['newPassword'].invalid && component['newPassword'].dirty) || 
                                    (submitted && component['newPassword'].invalid),
                                    'is-valid': component['newPassword'].valid && passwordForm.get('newPassword').value}">
                                <label for="newPassword">New Password</label>
                                <div class="invalid-feedback" *ngIf="component['newPassword'].invalid && 
                       (component['newPassword'].dirty || submitted)">
                                    <span *ngIf="component['newPassword'].errors?.['required']">New Password
                                        Required</span>
                                    <ul *ngIf="component['newPassword'].errors?.['passwordStrength']" class="mb-0">
                                        <li *ngIf="!passwordRequirements.uppercase">Password must contain at least one uppercase letter</li>
                                        <li *ngIf="!passwordRequirements.lowercase">Password must contain at least one lowercase letter</li>
                                        <li *ngIf="!passwordRequirements.symbol">Password must contain at least one special character</li>
                                        <li *ngIf="!passwordRequirements.length">Password must be at least 8 characters long</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="password" class="form-control" formControlName="confirmPassword"
                                    id="confirmPassword" placeholder="New Password (Re-Enter)"
                                    [ngClass]="{'is-invalid': (component['confirmPassword'].invalid && component['confirmPassword'].dirty) || 
                                    (submitted && component['confirmPassword'].invalid),
                                    'is-valid': component['confirmPassword'].valid && 
                                    passwordForm.get('newPassword').value === passwordForm.get('confirmPassword').value}">
                                <label for="confirmPassword">New Password (Re-Enter)</label>
                                <div class="invalid-feedback" *ngIf="component['confirmPassword'].invalid && 
                       (component['confirmPassword'].dirty || submitted)">
                                    <span *ngIf="component['confirmPassword'].errors?.['required']">Password confirmation is required</span>
                                    <span *ngIf="component['confirmPassword'].errors?.['notSame']">Passwords do not match</span>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary"
                                [disabled]="passwordForm.invalid || submitted">
                                Change Password
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Addresses Section -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3 class="card-title mb-0">My Addresses</h3>
                        <button class="btn btn-primary btn-sm" (click)="showAddAddressForm()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                class="bi bi-plus" viewBox="0 0 16 16">
                                <path
                                    d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                            </svg> Add New Address
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <ng-container *ngIf="!isLoadingAddresses; else addressesSkeleton">
                                <div class="col-md-6 mb-3" *ngFor="let address of addresses">
                                    <div class="card h-100">
                                        <div class="item-card fade-in">
                                            <div class="card-body">
                                                <h5 class="card-title">
                                                    {{ address.name }}
                                                    <span class="badge" *ngIf="address.isDefault">Default</span>
                                                </h5>
                                                <p class="card-text">
                                                    {{ address.addressLine1 }}<br>
                                                    <span *ngIf="address.addressLine2">{{ address.addressLine2 }}<br></span>
                                                    {{ address.city }}, {{ address.state }} {{ address.postalCode }}<br>
                                                    {{ address.country }}
                                                </p>
                                                <div class="btn-actions">
                                                    <button class="btn btn-outline-primary btn-sm" (click)="editAddress(address)">
                                                        <i class="bi bi-pencil"></i> Edit
                                                    </button>
                                                    <button class="btn btn-outline-danger btn-sm" (click)="confirmDeleteAddress(address.id)">
                                                        <i class="bi bi-trash"></i> Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12" *ngIf="addresses.length === 0">
                                    <div class="alert alert-info">
                                        No addresses have been saved yet.
                                    </div>
                                </div>
                            </ng-container>
                            <ng-template #addressesSkeleton>
                                <div class="col-md-6 mb-3" *ngFor="let i of [1,2]">
                                    <div class="card h-100">
                                        <div class="item-card fade-in">
                                            <div class="card-body">
                                                <div class="skeleton-title"></div>
                                                <div class="skeleton-text"></div>
                                                <div class="skeleton-text"></div>
                                                <div class="skeleton-text"></div>
                                                <div class="skeleton-actions"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </ng-template>
                        </div>
                    </div>
                </div>

                <!-- Phone Numbers Section -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3 class="card-title mb-0">My Phone Numbers</h3>
                        <button class="btn btn-primary btn-sm" (click)="showAddPhoneForm()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                                class="bi bi-plus" viewBox="0 0 16 16">
                                <path
                                    d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                            </svg> Add New Phone
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <ng-container *ngIf="!isLoadingPhones; else phonesSkeleton">
                                <div class="col-md-6 mb-3" *ngFor="let phone of phoneNumbers">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title d-flex justify-content-between align-items-center">
                                                {{ phone.name }}
                                                <span class="badge bg-primary" *ngIf="phone.isDefault">Default</span>
                                            </h5>
                                            <p class="card-text">{{ phone.number }}</p>
                                            <div class="mt-3">
                                                <button class="btn btn-sm btn-outline-primary me-2" (click)="editPhone(phone)">
                                                    <i class="bi bi-pencil"></i> Edit
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger" (click)="confirmDeletePhone(phone.id)">
                                                    <i class="bi bi-trash"></i> Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12" *ngIf="phoneNumbers.length === 0">
                                    <div class="alert alert-info">
                                        No phone numbers have been saved yet.
                                    </div>
                                </div>
                            </ng-container>
                            <ng-template #phonesSkeleton>
                                <div class="col-md-6 mb-3" *ngFor="let i of [1,2]">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <div class="skeleton-title"></div>
                                            <div class="skeleton-text"></div>
                                            <div class="skeleton-actions"></div>
                                        </div>
                                    </div>
                                </div>
                            </ng-template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-2"></div>
</div>
<app-downbar></app-downbar>

<!-- Address Modal -->
<div class="modal fade" id="addressModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ isEditMode ? 'Edit Address' : 'Add New Address' }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="addressForm">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" formControlName="name" id="addressName"
                            placeholder="Address Title">
                        <label for="addressName">Address Title</label>
                        <div class="invalid-feedback"
                            *ngIf="addressForm.get('name')?.invalid && addressForm.get('name')?.touched">
                            Address title is required
                        </div>
                    </div>

                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" formControlName="addressLine1" id="addressLine1"
                            placeholder="Address Line 1">
                        <label for="addressLine1">Address Line 1</label>
                        <div class="invalid-feedback"
                            *ngIf="addressForm.get('addressLine1')?.invalid && addressForm.get('addressLine1')?.touched">
                            Address line 1 is required
                        </div>
                    </div>

                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" formControlName="addressLine2" id="addressLine2"
                            placeholder="Address Line 2">
                        <label for="addressLine2">Address Line 2 (Optional)</label>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" formControlName="city" id="city"
                                    placeholder="City">
                                <label for="city">City</label>
                                <div class="invalid-feedback"
                                    *ngIf="addressForm.get('city')?.invalid && addressForm.get('city')?.touched">
                                    City is required
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" formControlName="state" id="state"
                                    placeholder="State">
                                <label for="state">State</label>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" formControlName="postalCode" id="postalCode"
                                    placeholder="Postal Code">
                                <label for="postalCode">Postal Code</label>
                                <div class="invalid-feedback"
                                    *ngIf="addressForm.get('postalCode')?.invalid && addressForm.get('postalCode')?.touched">
                                    Postal code is required
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" formControlName="country" id="country"
                                    placeholder="Country">
                                <label for="country">Country</label>
                                <div class="invalid-feedback"
                                    *ngIf="addressForm.get('country')?.invalid && addressForm.get('country')?.touched">
                                    Country is required
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" formControlName="isDefault"
                            id="isDefaultAddress">
                        <label class="form-check-label" for="isDefaultAddress">Set as default address</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" (click)="saveAddress()"
                    [disabled]="addressForm.invalid">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Phone Modal -->
<div class="modal fade" id="phoneModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ isEditMode ? 'Edit Phone' : 'Add New Phone' }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="phoneForm">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" formControlName="name" id="phoneName"
                            placeholder="Phone Title">
                        <label for="phoneName">Phone Title</label>
                        <div class="invalid-feedback"
                            *ngIf="phoneForm.get('name')?.invalid && phoneForm.get('name')?.touched">
                            Phone title is required
                        </div>
                    </div>

                    <div class="form-floating mb-3">
                        <input type="tel" class="form-control" formControlName="number" id="phoneNumber"
                            placeholder="Phone Number">
                        <label for="phoneNumber">Phone Number</label>
                        <div class="invalid-feedback"
                            *ngIf="phoneForm.get('number')?.invalid && phoneForm.get('number')?.touched">
                            <span *ngIf="phoneForm.get('number')?.errors?.['required']">Phone number is required</span>
                            <span *ngIf="phoneForm.get('number')?.errors?.['pattern']">Please enter a valid phone number (05XX XXX XX XX)</span>
                        </div>
                    </div>

                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" formControlName="isDefault" id="isDefaultPhone">
                        <label class="form-check-label" for="isDefaultPhone">Set as default number</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" (click)="savePhone()"
                    [disabled]="phoneForm.invalid">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>{{ deleteConfirmMessage }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" (click)="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>
</div>